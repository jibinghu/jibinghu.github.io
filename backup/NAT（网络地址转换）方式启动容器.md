以 NAT（网络地址转换）方式启动容器，通常指的是容器通过 Docker 的默认网络模式 bridge（桥接）模式 来访问外部网络。下面详细解释 NAT 和其在 Docker 容器中的应用。

NAT 的基本概念

NAT（Network Address Translation，网络地址转换）是一种网络技术，用于将私有网络地址转换为公有网络地址，从而实现局域网设备访问外部网络。
	•	工作原理：
	•	私有地址通过 NAT 映射到公共地址。
	•	外部网络只能通过 NAT 路由访问私有网络中的设备。
	•	NAT 的类型：
	•	源 NAT（SNAT）：用于修改流量的源 IP（常用于内网设备访问外部网络）。
	•	目的 NAT（DNAT）：用于修改流量的目标 IP（常用于端口转发）。

Docker 中的 NAT

在 Docker 中，NAT 是默认的网络配置方式之一，结合了 bridge（桥接）网络模式 来实现。
	•	桥接模式（默认网络模式）：
	•	Docker 为每个容器分配一个私有 IP 地址。
	•	容器的网络流量通过 Docker 主机的网桥接口 docker0 转发到外部网络。
	•	NAT 用于将容器的私有 IP 映射到宿主机的 IP 地址，方便容器访问外部网络。
	•	流程概述：
	1.	容器启动时，分配私有 IP 并连接到 docker0 虚拟网桥。
	2.	宿主机通过 iptables 配置 NAT 转发规则：
	•	容器发送数据时，私有 IP 会被 NAT 转换为宿主机的公网 IP。
	•	外部流量返回宿主机时，根据 NAT 映射规则转发到对应容器。

以 NAT（桥接）方式启动容器

默认情况下，Docker 启动容器时会使用桥接网络模式，这种模式依赖 NAT 实现外网访问。

启动命令

docker run -d --name my_container nginx

	•	Docker 默认以桥接模式启动容器。
	•	容器内部的 IP 地址由 Docker 自动分配，如 172.17.0.2。
	•	容器通过宿主机的 NAT 转发规则访问外部网络。

验证 NAT 行为

	1.	查看 Docker 默认网络

docker network inspect bridge

	•	查看 bridge 网络的网关地址（通常是 172.17.0.1）。

	2.	检查 NAT 转发规则
Docker 使用 iptables 配置 NAT 转发规则，可以通过以下命令查看：

sudo iptables -t nat -L -n

	•	Docker 会添加 MASQUERADE 规则，用于将容器的私有 IP 转换为宿主机 IP。

	3.	验证容器的网络访问
在容器中执行命令，检查是否可以访问外网：

docker exec -it my_container ping -c 4 www.google.com

	•	如果 NAT 正常工作，容器可以成功访问外部网络。

优点和限制

优点

	1.	外网访问简单：
容器无需复杂配置即可通过宿主机访问外部网络。
	2.	网络隔离：
	•	容器间通过桥接网络进行通信，彼此隔离，安全性较高。
	3.	资源共享：
	•	容器共享宿主机的网络接口和 IP 地址资源。

限制

	1.	外部访问复杂：
	•	NAT 转发限制了外部设备直接访问容器，需要额外的端口映射。
	•	使用 -p 参数映射端口时，需手动指定映射关系：

docker run -d -p 8080:80 nginx

上述命令将宿主机的 8080 端口映射到容器的 80 端口。

	2.	性能开销：
	•	NAT 转发会增加一定的网络延迟，性能略低于其他网络模式（如 host 模式）。

与其他网络模式的对比

模式	说明	NAT 支持	适用场景
bridge	容器通过 NAT 转发访问外部网络，默认网络模式	支持（默认启用）	单机容器之间通信，访问外部网络
host	容器直接使用宿主机的网络堆栈，不经过 NAT	不需要	高性能、低延迟需求，网络隔离不重要
none	容器不配置任何网络	不适用	完全隔离的容器运行
custom network	用户自定义网络（如 overlay），容器可通过互联网络直接通信	可配置（可选启用）	多主机网络通信，如 Swarm 或 Kubernetes 环境

总结

以 NAT（桥接）方式启动容器是 Docker 的默认行为，它利用宿主机的 NAT 转发功能，使容器能够轻松访问外部网络，同时保持与外部的网络隔离。这种方式适合大多数单机部署场景，但对于需要高性能或直接外部访问的场景，可考虑其他网络模式（如 host 或自定义网络）。